(function(t){if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=t()}else if(typeof define==="function"&&define.amd){define([],t)}else{var e;if(typeof window!=="undefined"){e=window}else if(typeof global!=="undefined"){e=global}else if(typeof self!=="undefined"){e=self}else{e=this}e.WavEncoder=t()}})(function(){var t,e,n;return function r(t,e,n){function i(a,s){if(!e[a]){if(!t[a]){var f=typeof require=="function"&&require;if(!s&&f)return f(a,!0);if(o)return o(a,!0);var u=new Error("Cannot find module '"+a+"'");throw u.code="MODULE_NOT_FOUND",u}var c=e[a]={exports:{}};t[a][0].call(c.exports,function(e){var n=t[a][1][e];return i(n?n:e)},c,c.exports,r,t,e,n)}return e[a].exports}var o=typeof require=="function"&&require;for(var a=0;a<n.length;a++)i(n[a]);return i}({1:[function(t,e,n){"use strict";var self={};function r(){self.onmessage=function(t){switch(t.data.type){case"encode":self.encode(t.data.audioData,t.data.format).then(function(e){var n={type:"encoded",callbackId:t.data.callbackId,buffer:e};self.postMessage(n,[e])},function(e){var n={type:"error",callbackId:t.data.callbackId,message:e.message};self.postMessage(n)});break}};self.encode=function(e,n){n.floatingPoint=!!n.floatingPoint;n.bitDepth=n.bitDepth|0||16;return new Promise(function(r){var i=e.numberOfChannels;var o=e.sampleRate;var a=n.bitDepth>>3;var s=e.length*i*a;var f=new t(44+s);f.writeString("RIFF");f.writeUint32(f.length-8);f.writeString("WAVE");f.writeString("fmt ");f.writeUint32(16);f.writeUint16(n.floatingPoint?3:1);f.writeUint16(i);f.writeUint32(o);f.writeUint32(o*i*a);f.writeUint16(i*a);f.writeUint16(n.bitDepth);f.writeString("data");f.writeUint32(s);var u=e.buffers.map(function(t){return new Float32Array(t)});f.writePCM(u,n);r(f.toArrayBuffer())})};function t(t){this.buffer=new ArrayBuffer(t);this.view=new DataView(this.buffer);this.length=t;this.pos=0}t.prototype.writeUint8=function(t){this.view.setUint8(this.pos,t);this.pos+=1};t.prototype.writeUint16=function(t){this.view.setUint16(this.pos,t,true);this.pos+=2};t.prototype.writeUint32=function(t){this.view.setUint32(this.pos,t,true);this.pos+=4};t.prototype.writeString=function(t){for(var e=0;e<t.length;e++){this.writeUint8(t.charCodeAt(e))}};t.prototype.writePCM8=function(t){t=Math.max(-128,Math.min(t*128,127))|0;this.view.setInt8(this.pos,t);this.pos+=1};t.prototype.writePCM16=function(t){t=Math.max(-32768,Math.min(t*32768,32767))|0;this.view.setInt16(this.pos,t,true);this.pos+=2};t.prototype.writePCM24=function(t){t=Math.max(-8388608,Math.min(t*8388608,8388607))|0;this.view.setUint8(this.pos+0,t>>0&255);this.view.setUint8(this.pos+1,t>>8&255);this.view.setUint8(this.pos+2,t>>16&255);this.pos+=3};t.prototype.writePCM32=function(t){t=Math.max(-2147483648,Math.min(t*2147483648,2147483647))|0;this.view.setInt32(this.pos,t,true);this.pos+=4};t.prototype.writePCM32F=function(t){this.view.setFloat32(this.pos,t,true);this.pos+=4};t.prototype.writePCM64F=function(t){this.view.setFloat64(this.pos,t,true);this.pos+=8};t.prototype.writePCM=function(t,e){var n=t[0].length;var r=t.length;var i="writePCM"+e.bitDepth;if(e.floatingPoint){i+="F"}if(!this[i]){throw new Error("not suppoerted bit depth "+e.bitDepth)}for(var o=0;o<n;o++){for(var a=0;a<r;a++){this[i](t[a][o])}}};t.prototype.toArrayBuffer=function(){return this.buffer};self.BufferWriter=t}r.self=r.util=self;e.exports=r},{}],2:[function(t,e,n){"use strict";var r=function(t){return t&&t.__esModule?t["default"]:t};var i=function(){function t(t,e){for(var n in e){var r=e[n];r.configurable=true;if(r.value)r.writable=true}Object.defineProperties(t,e)}return function(e,n,r){if(n)t(e.prototype,n);if(r)t(e,r);return e}}();var o=function(t,e){if(!(t instanceof e)){throw new TypeError("Cannot call a class as a function")}};"use stirct";var a=r(t("inline-worker"));var s=r(t("./encoder-worker"));var f=function(){function t(){var e=this;var n=arguments[0]===undefined?{}:arguments[0];o(this,t);this.format={floatingPoint:!!n.floatingPoint,bitDepth:n.bitDepth|0||16};this._worker=new a(s,s.self);this._worker.onmessage=function(t){var n=e._callbacks[t.data.callbackId];if(n){if(t.data.type==="encoded"){n.resolve(t.data.buffer)}else{n.reject(new Error(t.data.message))}}e._callbacks[t.data.callbackId]=null};this._callbacks=[]}i(t,{canProcess:{value:function e(n){return t.canProcess(n)}},encode:{value:function n(t){var e=this;var n=arguments[1]===undefined?this.format:arguments[1];return new Promise(function(r,i){var o=e._callbacks.length;e._callbacks.push({resolve:r,reject:i});var a=t.channelData.length;var s=t.channelData[0].length;var f=t.sampleRate;var u=t.channelData.map(function(t){return t.buffer});t={numberOfChannels:a,length:s,sampleRate:f,buffers:u};e._worker.postMessage({type:"encode",audioData:t,format:n,callbackId:o},t.buffers)})}}},{canProcess:{value:function r(t){if(t&&(t==="wav"||t.type==="wav")){return"maybe"}return""}},encode:{value:function f(e,n){return new t(n).encode(e)}}});return t}();e.exports=f},{"./encoder-worker":1,"inline-worker":4}],3:[function(t,e,n){"use strict";var r=function(t){return t&&t.__esModule?t["default"]:t};var i=r(t("./encoder"));e.exports=i},{"./encoder":2}],4:[function(t,e,n){"use strict";e.exports=t("./inline-worker")},{"./inline-worker":5}],5:[function(t,e,n){(function(t){"use strict";var n=function(){function t(t,e){for(var n in e){var r=e[n];r.configurable=true;if(r.value)r.writable=true}Object.defineProperties(t,e)}return function(e,n,r){if(n)t(e.prototype,n);if(r)t(e,r);return e}}();var r=function(t,e){if(!(t instanceof e)){throw new TypeError("Cannot call a class as a function")}};var i=!!(t===t.window&&t.URL&&t.Blob&&t.Worker);var o=function(){function e(n,self){var o=this;r(this,e);if(i){var a=n.toString().trim().match(/^function\s*\w*\s*\([\w\s,]*\)\s*{([\w\W]*?)}$/)[1];var s=t.URL.createObjectURL(new t.Blob([a],{type:"text/javascript"}));return new t.Worker(s)}this.self=self;this.self.postMessage=function(t){setTimeout(function(){o.onmessage({data:t})},0)};setTimeout(function(){n.call(self)},0)}n(e,{postMessage:{value:function o(t){var e=this;setTimeout(function(){e.self.onmessage({data:t})},0)}}});return e}();e.exports=o}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{}]},{},[3])(3)});